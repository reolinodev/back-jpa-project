#개발가이드

### @ application 설정
application.yml에는 기본적인 세팅값을 넣어줍니다. 각 dev, prod에는 그 환경에 맞는 값을 넣어줍니다.  application-dev의 값을 가져오려면 아래 처럼 active에 dev값을 넣어주고 
application-prod.yml 값을 불러오려면 prod를 넣어줍니다.
```yaml
spring:
  profiles:
    active: dev
```

jpa의 스키마를 자동으로 반영하려면 ddl-auto: update로 변경합니다. (일반적으로는 none로 설정
```yaml
  jpa:
    database-platform: com.back.config.PostgreSQLConfig
    hibernate:
      ddl-auto: update
    show-sql: false
```

포트를 변경하려면 server.port를 수정합니다.
```yaml
server:
  port: 9080
```

데이터 베이스를 수정하려면 아래의 정보를 수정합니다. 아래는 postgresql을 로컬에 설치해놓고 설정한 값입니다.
다른 DB를 사용하려면 옵션값을 바꿔야 할 수 있습니다. 
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size:  4
    driver-class-name: com.p6spy.engine.spy.P6SpyDriver
    url:  jdbc:p6spy:postgresql://localhost:5432/bdrnd
    username: bdrnd
    password: bdrnd
```
토큰의 대한 정보입니다. secret은 토큰키이며 validLongYn은 개발을 할때 토큰의 활성화 기간을 반영구적으로 
늘리고 다중접속을 가능하게 하기 위한 키값입니다. 개발할때는 Y로 놓고 실제 서비스할때는 N으로 하세요.
accessToken은 기본 8시간이며 refreshToken은 24시간으로 설정했습니다.
```yaml
jwt:
  secret: reolino
  validLongYn: Y
  accessTokenValidTime: 28800000
  refreshTokenValidTime: 86400000
```

### @ security 예외 처리
spring security의 모든 domain의 호출을 검증하기 때문에 예외처리를 해야 하는 경우는 ExceptionSecurityConstants.java
에 url을 넣어줍니다. 아래는 인증과 각 콤보박스에서 호출되는 url을 예외 처리한 케이스입니다.

```java
/**
     * 인터셉터 제외 URL
     */
    public static final String[] permitAllArray = new String[] {
        "/",
        "/api/certification",
        "/api/item/**/**",
        "/api/item/**/**/**",
    };
```

### @ querydsl 컴파일
querydsl은 사용은 편하지만 종속적인 형태입니다. entity를 새로 작성하거나 수정하는 경우 Gradle - other - compileQueryDsl을 선택해 build를 해줘야 적용됩니다.

### @ querydsl에서 DB의 function을 써야 하는 경우
PostGresql.config에 함수를 추가해줘야 해당 함수가 호출됩니다.

```java
public class PostgreSQLConfig extends PostgreSQL10Dialect {

    public PostgreSQLConfig() {
        super();
        this.registerFunction("ws.fn_get_code_nm", new StandardSQLFunction("ws.fn_get_code_nm", new StringType()));
        this.registerFunction("ws.fn_get_user_nm", new StandardSQLFunction("ws.fn_get_user_nm", new StringType()));
    }
}

```


### @ Test 코드 작성
서비스 단의 테스트 코드는 작성을 하지 않아도 되지만 (하지만 작성하는 걸 추천. 개발 속도에 도움이 됨) 실제 rest Api에서 호출하는 테스트 코드는 작성해주세요.
api 폴더 안에 작성을 하면 됩니다. 형식은 아래와 같습니다.
```http request
# name   : /api/certification
# method : POST
# param  : loginId - 로그인 아이디 / 필수
#        : userPw - 비밀번호 / 필수
#        : loginDevice - 접속장비 / 선택
#        : deviceBrowser - 브라우저 / 선택

POST http://localhost:9080/api/login
Content-Type: application/json
Authorization: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0MkBnbWFpbC5jb20iLCJ1c2VyTm0iOiLthYzsiqTthLAzMyIsImxvZ2luSWQiOiJ0ZXN0MkBnbWFpbC5jb20iLCJ1c2VyUHciOiIwZmZlMWFiZDFhMDgyMTUzNTNjMjMzZDZlMDA5NjEzZTk1ZWVjNDI1MzgzMmE3NjFhZjI4ZmYzN2FjNWExNTBjIiwiZXhwIjoyMDA1NjEwNjkxLCJpYXQiOjE2OTAyNTA2OTEsInVzZXJJZCI6NH0.kGSGH9Q1VomglYmSkVKSCUYswY7Bz5BoSR3hZ4Cw-ZI

{
  "loginId":"admin@gmail.com",
  "userPw": "1234"
}

```
### @ DB 초기 데이터 설정
DB 폴더의 ddl 안에 있는 스크립트를 실행합니다. 해당 DDL은 Postgresql 입니다.
function 스크립트도 실행합니다.
기본적으로 DB에 세팅해야 할 데이터는 initServiceTest.java 파일을 실행시키면 됩니다. 



### @ 기본 구조 및 명명 규칙

#### # Domain
Entity, Param, DTO 세개가 한쌍으로 만들어집니다.
- Entity : DB에 적용될 객체 
- Param : 프론트엔드에서 백엔드로 전달할 객체로 validation 처리를 해줍니다.
- DTO : 백엔드에서 프론트엔드로 전달할 객체입니다. 

- 예시) User, UserParam, UserDto 참고

#### # Controller
대부분 RestController이며 클라이언트 전달 받은 데이터를 Service에 전달해주고 Response된 값을 규약에 맞게 가공해서 프론트엔드로 전달해줍니다.
- RestApi 규약 문서를 참고하여 개발합니다.
- method 명은 아래와 같이 개발합니다.

| method | 기능 | 예시 |
|---|:---|:---|
|get단수형()|한개의 데이터를 반환하는 경우|getUser|
|get복수형()|여러의 데이터를 반환하는 경우|getUsers|
|create단수형()|한개의 데이터를 받아서 DB에 생성하는 경우|createUser|
|create복수형()|여러개의 데이터를 받아서 DB에 생성하는 경우|createUsers|
|update단수형()|한개의 데이터를 받아서 DB에서 수정하는 경우|updateUser|
|update복수형()|여러개의 데이터를 받아서 DB에서 수정하는 경우|updateUsers|
|save단수형()|한개의 데이터를 받아서 DB에서 입력, 수정하는 경우|saveUser|
|save복수형()|여러개의 데이터를 받아서 DB에서 입력, 수정하는 경우|saveUsers|
|delete단수형()|한개의 데이터를 받아서 DB에 삭제하거나 사용을 하지 않게 수정 경우|deleteUser|
|delete복수형()|여러개의 데이터를 받아서 DB에 삭제하거나 사용을 하지 않게 수정 경우|deleteUsers|

| 단어 | 설명 |
|---|:---|
|초기화|init|
|수|count|
|상태확인|check|

이런식으로 적합한 단어를 잘 조합해서 사용하면됩니다.
예시) checkUserStatus, initUserStatus, getUserCount 

#### # Service
Service의 method명은 가급적 controller의 method와 동일하게 갑니다.


#### # Repository
일반적인 JPA Repository를 상속하는 경우 Entity명+Reopository, QueryDsl을 사용하는 경우에는 
Entity명+CustomRepository를 명명합니다.
예시) UserRepository, UserCustomRepository

- 대부분의 조회는 QueryDsl을 사용해 작성합니다. (N+1 현상 방지 및 동적쿼리 가능)
- 대량의 업데이트 건은 native 쿼리로 처리해주세요. (@Transactional 넣어주세요.) 
- jpa 쿼리로 해결이 어려운 경우, 예를 들어 차트 데이터나 함수를 써야 하는 경우는 native 쿼리로 처리해주세요. Return은 IF로 작성해야 적용됩니다.



